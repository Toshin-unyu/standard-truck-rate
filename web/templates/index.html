{{template "header" .}}
{{define "title"}}運賃計算 - STR{{end}}

<div class="max-w-4xl mx-auto">
    <h1 class="text-2xl font-bold text-gray-800 mb-6">トラック運賃計算</h1>

    <!-- 入力フォーム -->
    <div class="bg-white rounded-lg shadow-md p-6 mb-6">
        <form id="fareForm"
              hx-post="/api/fare/calculate"
              hx-target="#result"
              hx-swap="innerHTML"
              hx-indicator="#loading">

            <!-- 出発地・目的地 -->
            <div class="mb-6">
                <h2 class="text-lg font-semibold text-gray-700 mb-4 pb-2 border-b">出発地・目的地</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <!-- 出発地 -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">出発地</label>
                        <input type="text" name="origin" required
                               placeholder="例: 東京都千代田区丸の内1-1-1"
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <p class="text-xs text-gray-500 mt-1">地名・住所・郵便番号で入力</p>
                    </div>

                    <!-- 目的地 -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">目的地</label>
                        <input type="text" name="dest" required
                               placeholder="例: 大阪府大阪市中央区"
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <p class="text-xs text-gray-500 mt-1">地名・住所・郵便番号で入力</p>
                    </div>
                </div>
            </div>

            <!-- 車格・荷役時間 -->
            <div class="mb-6">
                <h2 class="text-lg font-semibold text-gray-700 mb-4 pb-2 border-b">車格・荷役時間</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <!-- 車格 -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">車格</label>
                        <select name="vehicle_code" required
                                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <option value="1">小型車（2t）</option>
                            <option value="2">中型車（4t）</option>
                            <option value="3" selected>大型車（10t）</option>
                            <option value="4">トレーラー（20t）</option>
                        </select>
                    </div>

                    <!-- 荷役時間 -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">荷役時間（分）</label>
                        <input type="number" name="loading_minutes" required min="0" max="9999" value="60"
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <p class="text-xs text-gray-500 mt-1">積み下ろし作業時間</p>
                    </div>
                </div>
            </div>

            <!-- オプション -->
            <div class="mb-6">
                <h2 class="text-lg font-semibold text-gray-700 mb-4 pb-2 border-b">オプション</h2>
                <div class="space-y-3">
                    <!-- 割増オプション -->
                    <div class="flex flex-wrap gap-6">
                        <label class="flex items-center">
                            <input type="checkbox" name="is_night" value="true"
                                   class="w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500">
                            <span class="ml-2 text-sm text-gray-700">深夜割増（22:00-05:00）+30%</span>
                        </label>
                        <label class="flex items-center">
                            <input type="checkbox" name="is_holiday" value="true"
                                   class="w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500">
                            <span class="ml-2 text-sm text-gray-700">休日割増（日祝日）+20%</span>
                        </label>
                    </div>

                    <!-- 計算方式オプション -->
                    <div class="pt-2">
                        <label class="flex items-center">
                            <input type="checkbox" name="use_simple_base_km" value="true"
                                   class="w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500">
                            <span class="ml-2 text-sm text-gray-700">シンプル版基礎走行キロ使用（時間制）</span>
                        </label>
                        <p class="text-xs text-gray-500 ml-6 mt-1">チェックなし: トラ協PDF版基礎キロを使用</p>
                    </div>
                </div>
            </div>

            <!-- 計算ボタン -->
            <div class="flex items-center gap-4">
                <button type="submit"
                        class="flex-1 bg-blue-600 text-white py-3 px-6 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 font-medium transition-colors">
                    運賃を計算
                </button>
                <div id="loading" class="htmx-indicator">
                    <svg class="animate-spin h-6 w-6 text-blue-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                </div>
            </div>
        </form>
    </div>

    <!-- 計算結果表示エリア -->
    <div id="result">
        <div class="bg-white rounded-lg shadow-md p-6">
            <h2 class="text-lg font-semibold text-gray-700 mb-4">使い方</h2>
            <div class="space-y-3 text-sm text-gray-600">
                <p>1. 出発地と目的地を入力してください</p>
                <p>2. 車格と荷役時間を設定してください</p>
                <p>3. 必要に応じて割増オプションを選択してください</p>
                <p>4. 「運賃を計算」ボタンをクリックすると、4種類の運賃を比較表示します</p>
            </div>
            <div class="mt-4 p-4 bg-blue-50 rounded-md">
                <p class="text-sm text-blue-800">
                    <strong>自動取得される項目：</strong><br>
                    ・運輸局（出発地の都道府県から判定）<br>
                    ・距離（Google Maps APIで取得）<br>
                    ・走行時間（Google Maps APIで取得）<br>
                    ・赤帽地区（東京23区/大阪市内を自動判定）
                </p>
            </div>
            <div class="mt-4 p-4 bg-gray-50 rounded-md">
                <p class="text-sm text-gray-700">
                    <strong>計算される運賃：</strong><br>
                    ・距離制運賃（トラ協基準）<br>
                    ・時間制運賃（トラ協基準）<br>
                    ・赤帽運賃（距離制）<br>
                    ・赤帽運賃（時間制）
                </p>
            </div>
        </div>
    </div>
</div>

{{template "footer" .}}
