{{define "result"}}
<div class="space-y-6">
    <!-- 計算根拠 -->
    <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
        <h3 class="text-base font-medium text-blue-800 mb-2">計算根拠</h3>
        {{if eq .VehicleCode 0}}
        <!-- 軽貨物の場合 -->
        <div class="flex flex-wrap gap-x-6 gap-y-1 text-sm text-blue-700 mb-2">
            <span>車格: <strong>軽貨物/赤帽</strong></span>
            <span>距離: <strong>{{printf "%.1f" .DistanceKmRaw}}km</strong></span>
            {{if .AkabouDistanceResult.Area}}
            <span>地区: <strong>{{.AkabouDistanceResult.Area}}</strong></span>
            {{end}}
        </div>
        <div class="flex flex-wrap gap-x-4 gap-y-1 text-xs text-blue-600">
            <span>走行: {{formatDuration .DrivingMinutes}} + 荷役: {{formatDuration .LoadingMinutes}} = 合計 {{formatDuration (add .DrivingMinutes .LoadingMinutes)}}</span>
        </div>
        {{else}}
        <!-- 2t以上の場合 -->
        <div class="flex flex-wrap gap-x-6 gap-y-1 text-sm text-blue-700 mb-2">
            <span>運輸局: <strong>{{regionName .DistanceFareResult.RegionCode}}</strong></span>
            <span>車格: <strong>{{vehicleName .DistanceFareResult.VehicleCode}}</strong></span>
            <span>経路距離: <strong>{{printf "%.1f" .DistanceKmRaw}}km</strong> → 計算距離: <strong>{{.DistanceFareResult.RoundedKm}}km</strong></span>
        </div>
        <div class="flex flex-wrap gap-x-4 gap-y-1 text-xs text-blue-600">
            <span>走行: {{formatDuration .TimeFareResult.DrivingMinutes}} + 荷役: {{formatDuration .LoadingMinutes}} = 合計 {{formatDuration .TimeFareResult.TotalMinutes}} → {{.TimeFareResult.AppliedHours}}時間制適用</span>
            <span>基礎走行キロ: {{.TimeFareResult.BaseKm}}km → 超過: {{.TimeFareResult.ExcessKm}}km</span>
        </div>
        {{end}}
    </div>

    <!-- 運賃比較（横並びカラム） -->
    <div class="bg-white rounded-lg border border-gray-200 p-6">
        <h2 class="text-base font-semibold text-gray-800 mb-5">運賃比較</h2>

        {{/* 最安値を取得（Rankings[0]が最安） */}}
        {{$minFare := (index .Rankings 0).Fare}}

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            {{range .Rankings}}
            <div class="relative p-5 rounded-lg border-2 transition-all {{if eq .Rank 1}}border-green-500 bg-green-50{{else}}border-gray-200 bg-gray-50 hover:border-gray-300{{end}}">
                <!-- 推奨バッジ -->
                {{if eq .Rank 1}}
                <div class="absolute -top-2.5 left-4 px-2 py-0.5 bg-green-500 text-white text-xs font-bold rounded-full">
                    推奨
                </div>
                {{end}}

                <!-- 運賃タイプ -->
                <div class="text-center mb-3 pt-1">
                    <span class="text-sm font-medium {{if eq .Rank 1}}text-green-700{{else}}text-gray-600{{end}}">{{.Type}}</span>
                </div>

                <!-- 金額 -->
                <div class="text-center">
                    <span class="text-2xl font-bold {{if eq .Rank 1}}text-green-600{{else}}text-gray-800{{end}}">&yen;{{formatNumber .Fare}}</span>
                    {{if eq .Rank 1}}
                    <div class="text-xs text-green-600 mt-1">最安</div>
                    {{end}}
                </div>

                <!-- 高速代 + 合計（高速使用時のみ） -->
                {{if and $.UseHighway $.HighwayToll}}
                <div class="mt-3 pt-3 border-t {{if eq .Rank 1}}border-green-200{{else}}border-gray-200{{end}}">
                    <div class="flex justify-between text-xs {{if eq .Rank 1}}text-green-600{{else}}text-gray-500{{end}} mb-1">
                        <span>+ 高速代（ETC）</span>
                        <span>&yen;{{formatNumber $.HighwayToll.EtcToll}}</span>
                    </div>
                    <div class="flex justify-between items-center font-bold {{if eq .Rank 1}}text-green-700{{else}}text-gray-700{{end}}">
                        <span class="text-sm">合計</span>
                        <span class="text-lg">&yen;{{formatNumber (add .Fare $.HighwayToll.EtcToll)}}</span>
                    </div>
                </div>
                {{end}}
            </div>
            {{end}}
        </div>
    </div>

    {{if .UseHighway}}
    <!-- 高速料金 -->
    <div class="bg-white rounded-lg border border-gray-200 p-6">
        <h2 class="text-base font-semibold text-gray-800 mb-4">高速料金</h2>
        {{if .HighwayError}}
        <div class="bg-red-50 border border-red-200 rounded-md p-4 text-sm text-red-700">
            <p>{{.HighwayError}}</p>
        </div>
        {{else if .HighwayToll}}
        <div class="space-y-4">
            <!-- 区間情報（1行表示） -->
            <div class="flex flex-wrap items-center gap-x-2 gap-y-1 text-sm pb-3 border-b border-gray-200">
                <span class="font-medium text-gray-800">{{.HighwayToll.OriginIC}}</span>
                <span class="text-gray-400">→</span>
                <span class="font-medium text-gray-800">{{.HighwayToll.DestIC}}</span>
                <span class="text-gray-300 hidden sm:inline">|</span>
                <span class="text-gray-600">{{.HighwayToll.CarTypeName}}</span>
                <span class="text-gray-300 hidden sm:inline">|</span>
                <span class="text-gray-600">{{printf "%.1f" .HighwayToll.DistanceKm}}km</span>
                {{if gt .HighwayToll.DurationMin 0}}
                <span class="text-gray-300 hidden sm:inline">|</span>
                <span class="text-gray-600">約{{formatDuration .HighwayToll.DurationMin}}</span>
                {{end}}
            </div>

            <!-- 料金3区分（グリッド） -->
            <div class="grid grid-cols-3 gap-3 text-center">
                <!-- 通常料金 -->
                <div class="bg-gray-50 p-3 rounded-lg">
                    <div class="text-xs text-gray-500 mb-1">通常料金</div>
                    <div class="text-lg font-bold text-gray-800">&yen;{{formatNumber .HighwayToll.NormalToll}}</div>
                </div>
                <!-- ETC料金 -->
                <div class="bg-blue-50 p-3 rounded-lg">
                    <div class="text-xs text-blue-600 mb-1">ETC料金</div>
                    <div class="text-lg font-bold text-blue-700">&yen;{{formatNumber .HighwayToll.EtcToll}}</div>
                    {{if gt .HighwayToll.NormalToll 0}}
                    <div class="text-xs text-blue-500 mt-1">&yen;{{formatNumber (sub .HighwayToll.NormalToll .HighwayToll.EtcToll)}}お得</div>
                    {{end}}
                </div>
                <!-- ETC2.0（最安バッジ付き） -->
                <div class="relative bg-green-50 p-3 rounded-lg border-2 border-green-400">
                    {{if le .HighwayToll.Etc2Toll .HighwayToll.EtcToll}}
                    <div class="absolute -top-2 left-1/2 -translate-x-1/2 px-2 py-0.5 bg-green-500 text-white text-xs font-bold rounded whitespace-nowrap">最安</div>
                    {{end}}
                    <div class="text-xs text-green-600 mb-1">ETC2.0</div>
                    <div class="text-lg font-bold text-green-700">&yen;{{formatNumber .HighwayToll.Etc2Toll}}</div>
                    {{if gt .HighwayToll.NormalToll 0}}
                    <div class="text-xs text-green-500 mt-1">&yen;{{formatNumber (sub .HighwayToll.NormalToll .HighwayToll.Etc2Toll)}}お得</div>
                    {{end}}
                </div>
            </div>

            {{if .HighwayToll.FromCache}}
            <div class="text-xs text-gray-400 text-right">キャッシュから取得</div>
            {{end}}
        </div>
        {{end}}
    </div>
    {{end}}

    <!-- 詳細表示（アコーディオン） -->
    <div class="bg-white rounded-lg border border-gray-200 p-6">
        <h2 class="text-base font-semibold text-gray-800 mb-4">計算詳細</h2>

        {{if eq .VehicleCode 0}}
        <!-- 軽貨物/赤帽の場合：赤帽運賃のみ表示 -->

        <!-- 赤帽（距離制） -->
        <details class="mb-4 border rounded-md overflow-hidden">
            <summary class="p-4 cursor-pointer bg-gray-50 hover:bg-gray-100 font-medium flex justify-between items-center">
                <span>赤帽運賃（距離制）</span>
                <span class="text-gray-700">&yen;{{formatNumber .AkabouDistanceResult.TotalFare}}</span>
            </summary>
            <div class="p-4 text-sm border-t bg-white">
                <!-- 基本情報 -->
                <div class="text-xs text-gray-500 mb-3 pb-2 border-b border-gray-100">
                    距離: {{.AkabouDistanceResult.DistanceKm}}km
                </div>
                <!-- 明細 -->
                <div class="space-y-2">
                    <div class="flex justify-between">
                        <span class="text-gray-600">基本料金（20km以内）</span>
                        <span class="font-medium">&yen;{{formatNumber .AkabouDistanceResult.BaseFare}}</span>
                    </div>
                    {{if gt .AkabouDistanceResult.DistanceCharge 0}}
                    <div class="flex justify-between">
                        <span class="text-gray-600">距離加算</span>
                        <span class="font-medium">+&yen;{{formatNumber .AkabouDistanceResult.DistanceCharge}}</span>
                    </div>
                    {{end}}
                    {{if gt .AkabouDistanceResult.AreaSurcharge 0}}
                    <div class="flex justify-between text-blue-600">
                        <span class="flex items-center gap-1">
                            <span>地区割増</span>
                            <span class="px-1.5 py-0.5 bg-blue-100 text-blue-700 text-xs rounded">{{.AkabouDistanceResult.Area}}</span>
                        </span>
                        <span class="font-medium">+&yen;{{formatNumber .AkabouDistanceResult.AreaSurcharge}}</span>
                    </div>
                    {{end}}
                    {{if .AkabouDistanceResult.IsNight}}
                    <div class="flex justify-between text-purple-600">
                        <span class="flex items-center gap-1">
                            <span>深夜割増</span>
                            <span class="px-1.5 py-0.5 bg-purple-100 text-purple-700 text-xs rounded">+30%</span>
                        </span>
                        <span class="font-medium">+&yen;{{formatNumber .AkabouDistanceResult.NightSurcharge}}</span>
                    </div>
                    {{end}}
                    {{if .AkabouDistanceResult.IsHoliday}}
                    <div class="flex justify-between text-orange-600">
                        <span class="flex items-center gap-1">
                            <span>休日割増</span>
                            <span class="px-1.5 py-0.5 bg-orange-100 text-orange-700 text-xs rounded">+20%</span>
                        </span>
                        <span class="font-medium">+&yen;{{formatNumber .AkabouDistanceResult.HolidaySurcharge}}</span>
                    </div>
                    {{end}}
                    {{if and .AdditionalFees (gt .AdditionalFees.TotalFee 0)}}
                    <div class="mt-2 pt-2 border-t border-gray-100">
                        <div class="text-xs text-gray-500 mb-1">付帯料金</div>
                        {{if gt .AdditionalFees.WorkFee 0}}
                        <div class="flex justify-between text-teal-600">
                            <span class="flex items-center gap-1">
                                <span>作業料金</span>
                                <span class="px-1.5 py-0.5 bg-teal-100 text-teal-700 text-xs rounded">{{.AdditionalFees.WorkMinutes}}分</span>
                            </span>
                            <span class="font-medium">+&yen;{{formatNumber .AdditionalFees.WorkFee}}</span>
                        </div>
                        {{end}}
                        {{if gt .AdditionalFees.WaitingFee 0}}
                        <div class="flex justify-between text-teal-600">
                            <span class="flex items-center gap-1">
                                <span>待機時間料</span>
                                <span class="px-1.5 py-0.5 bg-teal-100 text-teal-700 text-xs rounded">{{.AdditionalFees.WaitingMinutes}}分</span>
                            </span>
                            <span class="font-medium">+&yen;{{formatNumber .AdditionalFees.WaitingFee}}</span>
                        </div>
                        {{end}}
                    </div>
                    {{end}}
                </div>
                <!-- 合計 -->
                <div class="flex justify-between mt-3 pt-3 border-t border-gray-200 font-bold text-gray-900 bg-gray-50 -mx-4 px-4 py-2 -mb-4">
                    <span>合計</span>
                    <span>&yen;{{formatNumber .AkabouDistanceResult.TotalFare}}</span>
                </div>
            </div>
        </details>

        <!-- 赤帽（時間制） -->
        <details class="border rounded-md overflow-hidden">
            <summary class="p-4 cursor-pointer bg-gray-50 hover:bg-gray-100 font-medium flex justify-between items-center">
                <span>赤帽運賃（時間制）</span>
                <span class="text-gray-700">&yen;{{formatNumber .AkabouTimeResult.TotalFare}}</span>
            </summary>
            <div class="p-4 text-sm border-t bg-white">
                <!-- 基本情報 -->
                <div class="text-xs text-gray-500 mb-3 pb-2 border-b border-gray-100">
                    作業時間: {{.AkabouTimeResult.DurationMin}}分（{{formatDuration .AkabouTimeResult.DurationMin}}）
                </div>
                <!-- 明細 -->
                <div class="space-y-2">
                    <div class="flex justify-between">
                        <span class="text-gray-600">基本料金（2時間まで）</span>
                        <span class="font-medium">&yen;{{formatNumber .AkabouTimeResult.BaseFare}}</span>
                    </div>
                    {{if gt .AkabouTimeResult.OvertimeCharge 0}}
                    <div class="flex justify-between">
                        <span class="text-gray-600">超過料金（{{.AkabouTimeResult.OvertimeMin}}分超過）</span>
                        <span class="font-medium">+&yen;{{formatNumber .AkabouTimeResult.OvertimeCharge}}</span>
                    </div>
                    {{end}}
                    {{if gt .AkabouTimeResult.AreaSurcharge 0}}
                    <div class="flex justify-between text-blue-600">
                        <span class="flex items-center gap-1">
                            <span>地区割増</span>
                            <span class="px-1.5 py-0.5 bg-blue-100 text-blue-700 text-xs rounded">{{.AkabouTimeResult.Area}}</span>
                        </span>
                        <span class="font-medium">+&yen;{{formatNumber .AkabouTimeResult.AreaSurcharge}}</span>
                    </div>
                    {{end}}
                    {{if .AkabouTimeResult.IsNight}}
                    <div class="flex justify-between text-purple-600">
                        <span class="flex items-center gap-1">
                            <span>深夜割増</span>
                            <span class="px-1.5 py-0.5 bg-purple-100 text-purple-700 text-xs rounded">+30%</span>
                        </span>
                        <span class="font-medium">+&yen;{{formatNumber .AkabouTimeResult.NightSurcharge}}</span>
                    </div>
                    {{end}}
                    {{if .AkabouTimeResult.IsHoliday}}
                    <div class="flex justify-between text-orange-600">
                        <span class="flex items-center gap-1">
                            <span>休日割増</span>
                            <span class="px-1.5 py-0.5 bg-orange-100 text-orange-700 text-xs rounded">+20%</span>
                        </span>
                        <span class="font-medium">+&yen;{{formatNumber .AkabouTimeResult.HolidaySurcharge}}</span>
                    </div>
                    {{end}}
                    {{if and .AdditionalFees (gt .AdditionalFees.TotalFee 0)}}
                    <div class="mt-2 pt-2 border-t border-gray-100">
                        <div class="text-xs text-gray-500 mb-1">付帯料金</div>
                        {{if gt .AdditionalFees.WorkFee 0}}
                        <div class="flex justify-between text-teal-600">
                            <span class="flex items-center gap-1">
                                <span>作業料金</span>
                                <span class="px-1.5 py-0.5 bg-teal-100 text-teal-700 text-xs rounded">{{.AdditionalFees.WorkMinutes}}分</span>
                            </span>
                            <span class="font-medium">+&yen;{{formatNumber .AdditionalFees.WorkFee}}</span>
                        </div>
                        {{end}}
                        {{if gt .AdditionalFees.WaitingFee 0}}
                        <div class="flex justify-between text-teal-600">
                            <span class="flex items-center gap-1">
                                <span>待機時間料</span>
                                <span class="px-1.5 py-0.5 bg-teal-100 text-teal-700 text-xs rounded">{{.AdditionalFees.WaitingMinutes}}分</span>
                            </span>
                            <span class="font-medium">+&yen;{{formatNumber .AdditionalFees.WaitingFee}}</span>
                        </div>
                        {{end}}
                    </div>
                    {{end}}
                </div>
                <!-- 合計 -->
                <div class="flex justify-between mt-3 pt-3 border-t border-gray-200 font-bold text-gray-900 bg-gray-50 -mx-4 px-4 py-2 -mb-4">
                    <span>合計</span>
                    <span>&yen;{{formatNumber .AkabouTimeResult.TotalFare}}</span>
                </div>
            </div>
        </details>

        {{else}}
        <!-- 2t以上の場合：トラ協運賃のみ表示 -->

        <!-- 距離制運賃 -->
        <details class="mb-4 border rounded-md overflow-hidden">
            <summary class="p-4 cursor-pointer bg-gray-50 hover:bg-gray-100 font-medium flex justify-between items-center">
                <span>距離制運賃（トラ協基準）</span>
                <span class="text-gray-700">&yen;{{formatNumber .DistanceFareResult.TotalFare}}</span>
            </summary>
            <div class="p-4 text-sm border-t bg-white">
                <!-- 基本情報 -->
                <div class="text-xs text-gray-500 mb-3 pb-2 border-b border-gray-100 flex flex-wrap gap-x-4 gap-y-1">
                    <span>{{regionName .DistanceFareResult.RegionCode}}</span>
                    <span>{{vehicleName .DistanceFareResult.VehicleCode}}</span>
                    <span>{{.DistanceFareResult.DistanceKm}}km → {{.DistanceFareResult.RoundedKm}}km</span>
                </div>
                <!-- 明細 -->
                <div class="space-y-2">
                    <div class="flex justify-between">
                        <span class="text-gray-600">基本運賃</span>
                        <span class="font-medium">&yen;{{formatNumber .DistanceFareResult.BaseFare}}</span>
                    </div>
                    {{if .DistanceFareResult.IsNight}}
                    <div class="flex justify-between text-purple-600">
                        <span class="flex items-center gap-1">
                            <span>深夜割増</span>
                            <span class="px-1.5 py-0.5 bg-purple-100 text-purple-700 text-xs rounded">+30%</span>
                        </span>
                        <span class="font-medium">+&yen;{{formatNumber .DistanceFareResult.NightSurcharge}}</span>
                    </div>
                    {{end}}
                    {{if .DistanceFareResult.IsHoliday}}
                    <div class="flex justify-between text-orange-600">
                        <span class="flex items-center gap-1">
                            <span>休日割増</span>
                            <span class="px-1.5 py-0.5 bg-orange-100 text-orange-700 text-xs rounded">+20%</span>
                        </span>
                        <span class="font-medium">+&yen;{{formatNumber .DistanceFareResult.HolidaySurcharge}}</span>
                    </div>
                    {{end}}
                </div>
                <!-- 合計 -->
                <div class="flex justify-between mt-3 pt-3 border-t border-gray-200 font-bold text-gray-900 bg-gray-50 -mx-4 px-4 py-2 -mb-4">
                    <span>合計</span>
                    <span>&yen;{{formatNumber .DistanceFareResult.TotalFare}}</span>
                </div>
            </div>
        </details>

        <!-- 時間制運賃 -->
        <details class="border rounded-md overflow-hidden">
            <summary class="p-4 cursor-pointer bg-gray-50 hover:bg-gray-100 font-medium flex justify-between items-center">
                <span>時間制運賃（トラ協基準）</span>
                <span class="text-gray-700">&yen;{{formatNumber .TimeFareResult.TotalFare}}</span>
            </summary>
            <div class="p-4 text-sm border-t bg-white">
                <!-- 基本情報 -->
                <div class="text-xs text-gray-500 mb-3 pb-2 border-b border-gray-100 flex flex-wrap gap-x-4 gap-y-1">
                    <span>{{regionName .TimeFareResult.RegionCode}}</span>
                    <span>{{vehicleName .TimeFareResult.VehicleCode}}</span>
                    <span>{{.TimeFareResult.AppliedHours}}時間制</span>
                </div>
                <div class="text-xs text-gray-500 mb-3 pb-2 border-b border-gray-100 flex flex-wrap gap-x-4 gap-y-1">
                    <span>走行: {{.TimeFareResult.DistanceKm}}km（基礎: {{.TimeFareResult.BaseKm}}km）</span>
                    <span>拘束: {{formatDuration .TimeFareResult.TotalMinutes}}</span>
                </div>
                <!-- 明細 -->
                <div class="space-y-2">
                    <div class="flex justify-between">
                        <span class="text-gray-600">基礎運賃</span>
                        <span class="font-medium">&yen;{{formatNumber .TimeFareResult.BaseFare}}</span>
                    </div>
                    {{if gt .TimeFareResult.DistanceSurcharge 0}}
                    <div class="flex justify-between">
                        <span class="text-gray-600">距離加算（超過{{.TimeFareResult.ExcessKm}}km）</span>
                        <span class="font-medium">+&yen;{{formatNumber .TimeFareResult.DistanceSurcharge}}</span>
                    </div>
                    {{end}}
                    {{if gt .TimeFareResult.TimeSurcharge 0}}
                    <div class="flex justify-between">
                        <span class="text-gray-600">時間加算（超過{{.TimeFareResult.ExcessMinutes}}分）</span>
                        <span class="font-medium">+&yen;{{formatNumber .TimeFareResult.TimeSurcharge}}</span>
                    </div>
                    {{end}}
                    {{if .TimeFareResult.IsNight}}
                    <div class="flex justify-between text-purple-600">
                        <span class="flex items-center gap-1">
                            <span>深夜割増</span>
                            <span class="px-1.5 py-0.5 bg-purple-100 text-purple-700 text-xs rounded">+30%</span>
                        </span>
                        <span class="font-medium">+&yen;{{formatNumber .TimeFareResult.NightSurcharge}}</span>
                    </div>
                    {{end}}
                    {{if .TimeFareResult.IsHoliday}}
                    <div class="flex justify-between text-orange-600">
                        <span class="flex items-center gap-1">
                            <span>休日割増</span>
                            <span class="px-1.5 py-0.5 bg-orange-100 text-orange-700 text-xs rounded">+20%</span>
                        </span>
                        <span class="font-medium">+&yen;{{formatNumber .TimeFareResult.HolidaySurcharge}}</span>
                    </div>
                    {{end}}
                </div>
                <!-- 合計 -->
                <div class="flex justify-between mt-3 pt-3 border-t border-gray-200 font-bold text-gray-900 bg-gray-50 -mx-4 px-4 py-2 -mb-4">
                    <span>合計</span>
                    <span>&yen;{{formatNumber .TimeFareResult.TotalFare}}</span>
                </div>
            </div>
        </details>

        {{end}}
    </div>

</div>
{{end}}

{{define "error"}}
<div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-md">
    <p class="font-medium">エラー</p>
    <p>{{.Error}}</p>
</div>
{{end}}
