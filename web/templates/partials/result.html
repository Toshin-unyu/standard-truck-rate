{{define "result"}}
<div class="space-y-6">
    <!-- 自動取得情報 -->
    <div class="bg-gray-100 border border-gray-200 rounded-lg p-4">
        <div class="flex flex-wrap gap-x-6 gap-y-1 text-sm text-gray-700">
            {{if eq .VehicleCode 0}}
            <!-- 軽貨物の場合 -->
            <span>車格: <strong>軽貨物/赤帽</strong></span>
            <span>距離: <strong>{{.AkabouDistanceResult.DistanceKm}}km</strong></span>
            <span>走行時間: <strong>{{formatDuration .DrivingMinutes}}</strong></span>
            {{if .AkabouDistanceResult.Area}}
            <span>地区: <strong>{{.AkabouDistanceResult.Area}}</strong></span>
            {{end}}
            {{else}}
            <!-- 2t以上の場合 -->
            <span>運輸局: <strong>{{regionName .DistanceFareResult.RegionCode}}</strong></span>
            <span>距離: <strong>{{.DistanceFareResult.DistanceKm}}km</strong></span>
            <span>走行時間: <strong>{{formatDuration .TimeFareResult.DrivingMinutes}}</strong></span>
            {{end}}
        </div>
    </div>

    <!-- 運賃比較（横並びカラム） -->
    <div class="bg-white rounded-lg border border-gray-200 p-6">
        <h2 class="text-base font-semibold text-gray-800 mb-5">運賃比較</h2>

        {{/* 最安値を取得（Rankings[0]が最安） */}}
        {{$minFare := (index .Rankings 0).Fare}}

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            {{range .Rankings}}
            <div class="relative p-5 rounded-lg border-2 transition-all {{if eq .Rank 1}}border-green-500 bg-green-50{{else}}border-gray-200 bg-gray-50 hover:border-gray-300{{end}}">
                <!-- 推奨バッジ -->
                {{if eq .Rank 1}}
                <div class="absolute -top-2.5 left-4 px-2 py-0.5 bg-green-500 text-white text-xs font-bold rounded-full">
                    推奨
                </div>
                {{end}}

                <!-- 運賃タイプ -->
                <div class="text-center mb-3 pt-1">
                    <span class="text-sm font-medium {{if eq .Rank 1}}text-green-700{{else}}text-gray-600{{end}}">{{.Type}}</span>
                </div>

                <!-- 金額 -->
                <div class="text-center">
                    <span class="text-3xl font-bold {{if eq .Rank 1}}text-green-600{{else}}text-gray-800{{end}}">&yen;{{formatNumber .Fare}}</span>
                    {{if eq .Rank 1}}
                    <div class="text-sm text-green-600 mt-1">最安</div>
                    {{else}}
                    <div class="text-sm text-gray-500 mt-1">+&yen;{{formatNumber (sub .Fare $minFare)}}</div>
                    {{end}}
                </div>
            </div>
            {{end}}
        </div>
    </div>

    <!-- 詳細表示（アコーディオン） -->
    <div class="bg-white rounded-lg border border-gray-200 p-6">
        <h2 class="text-base font-semibold text-gray-800 mb-4">計算詳細</h2>

        {{if eq .VehicleCode 0}}
        <!-- 軽貨物/赤帽の場合：赤帽運賃のみ表示 -->

        <!-- 赤帽（距離制） -->
        <details class="mb-4 border rounded-md">
            <summary class="p-4 cursor-pointer bg-gray-50 hover:bg-gray-100 font-medium">
                赤帽運賃（距離制）: &yen;{{formatNumber .AkabouDistanceResult.TotalFare}}
            </summary>
            <div class="p-4 text-sm space-y-1 border-t">
                <p>距離: {{.AkabouDistanceResult.DistanceKm}}km</p>
                <p>基本料金: &yen;{{formatNumber .AkabouDistanceResult.BaseFare}}（20km以内）</p>
                {{if gt .AkabouDistanceResult.DistanceCharge 0}}
                <p>距離加算: +&yen;{{formatNumber .AkabouDistanceResult.DistanceCharge}}</p>
                {{end}}
                {{if gt .AkabouDistanceResult.AreaSurcharge 0}}
                <p class="text-blue-600">地区割増（{{.AkabouDistanceResult.Area}}）: +&yen;{{formatNumber .AkabouDistanceResult.AreaSurcharge}}</p>
                {{end}}
                {{if .AkabouDistanceResult.IsNight}}
                <p class="text-purple-600">深夜割増: +&yen;{{formatNumber .AkabouDistanceResult.NightSurcharge}}（30%増）</p>
                {{end}}
                {{if .AkabouDistanceResult.IsHoliday}}
                <p class="text-orange-600">休日割増: +&yen;{{formatNumber .AkabouDistanceResult.HolidaySurcharge}}（20%増）</p>
                {{end}}
                <p class="font-bold pt-2 border-t mt-2">合計: &yen;{{formatNumber .AkabouDistanceResult.TotalFare}}</p>
            </div>
        </details>

        <!-- 赤帽（時間制） -->
        <details class="border rounded-md">
            <summary class="p-4 cursor-pointer bg-gray-50 hover:bg-gray-100 font-medium">
                赤帽運賃（時間制）: &yen;{{formatNumber .AkabouTimeResult.TotalFare}}
            </summary>
            <div class="p-4 text-sm space-y-1 border-t">
                <p>作業時間: {{.AkabouTimeResult.DurationMin}}分（{{formatDuration .AkabouTimeResult.DurationMin}}）</p>
                <p>基本料金: &yen;{{formatNumber .AkabouTimeResult.BaseFare}}（2時間まで）</p>
                {{if gt .AkabouTimeResult.OvertimeCharge 0}}
                <p>超過料金: +&yen;{{formatNumber .AkabouTimeResult.OvertimeCharge}}（{{.AkabouTimeResult.OvertimeMin}}分超過）</p>
                {{end}}
                {{if gt .AkabouTimeResult.AreaSurcharge 0}}
                <p class="text-blue-600">地区割増（{{.AkabouTimeResult.Area}}）: +&yen;{{formatNumber .AkabouTimeResult.AreaSurcharge}}</p>
                {{end}}
                {{if .AkabouTimeResult.IsNight}}
                <p class="text-purple-600">深夜割増: +&yen;{{formatNumber .AkabouTimeResult.NightSurcharge}}（30%増）</p>
                {{end}}
                {{if .AkabouTimeResult.IsHoliday}}
                <p class="text-orange-600">休日割増: +&yen;{{formatNumber .AkabouTimeResult.HolidaySurcharge}}（20%増）</p>
                {{end}}
                <p class="font-bold pt-2 border-t mt-2">合計: &yen;{{formatNumber .AkabouTimeResult.TotalFare}}</p>
            </div>
        </details>

        {{else}}
        <!-- 2t以上の場合：トラ協運賃のみ表示 -->

        <!-- 距離制運賃 -->
        <details class="mb-4 border rounded-md">
            <summary class="p-4 cursor-pointer bg-gray-50 hover:bg-gray-100 font-medium">
                距離制運賃（トラ協基準）: &yen;{{formatNumber .DistanceFareResult.TotalFare}}
            </summary>
            <div class="p-4 text-sm space-y-1 border-t">
                <p>運輸局: {{regionName .DistanceFareResult.RegionCode}}</p>
                <p>車格: {{vehicleName .DistanceFareResult.VehicleCode}}</p>
                <p>経路距離: {{.DistanceFareResult.DistanceKm}}km → 運賃計算距離: {{.DistanceFareResult.RoundedKm}}km</p>
                <p>基本運賃: &yen;{{formatNumber .DistanceFareResult.BaseFare}}</p>
                {{if .DistanceFareResult.IsNight}}
                <p class="text-purple-600">深夜割増: +&yen;{{formatNumber .DistanceFareResult.NightSurcharge}}（30%増）</p>
                {{end}}
                {{if .DistanceFareResult.IsHoliday}}
                <p class="text-orange-600">休日割増: +&yen;{{formatNumber .DistanceFareResult.HolidaySurcharge}}（20%増）</p>
                {{end}}
                <p class="font-bold pt-2 border-t mt-2">合計: &yen;{{formatNumber .DistanceFareResult.TotalFare}}</p>
            </div>
        </details>

        <!-- 時間制運賃 -->
        <details class="border rounded-md">
            <summary class="p-4 cursor-pointer bg-gray-50 hover:bg-gray-100 font-medium">
                時間制運賃（トラ協基準）: &yen;{{formatNumber .TimeFareResult.TotalFare}}
            </summary>
            <div class="p-4 text-sm space-y-1 border-t">
                <p>運輸局: {{regionName .TimeFareResult.RegionCode}}</p>
                <p>車格: {{vehicleName .TimeFareResult.VehicleCode}}</p>
                <p>時間制区分: {{.TimeFareResult.AppliedHours}}時間制</p>
                <p>走行距離: {{.TimeFareResult.DistanceKm}}km（基礎キロ: {{.TimeFareResult.BaseKm}}km）</p>
                <p>拘束時間: {{.TimeFareResult.TotalMinutes}}分（{{formatDuration .TimeFareResult.TotalMinutes}}）</p>
                <p>基礎運賃: &yen;{{formatNumber .TimeFareResult.BaseFare}}</p>
                {{if gt .TimeFareResult.DistanceSurcharge 0}}
                <p>距離加算: +&yen;{{formatNumber .TimeFareResult.DistanceSurcharge}}（超過{{.TimeFareResult.ExcessKm}}km）</p>
                {{end}}
                {{if gt .TimeFareResult.TimeSurcharge 0}}
                <p>時間加算: +&yen;{{formatNumber .TimeFareResult.TimeSurcharge}}（超過{{.TimeFareResult.ExcessMinutes}}分）</p>
                {{end}}
                {{if .TimeFareResult.IsNight}}
                <p class="text-purple-600">深夜割増: +&yen;{{formatNumber .TimeFareResult.NightSurcharge}}（30%増）</p>
                {{end}}
                {{if .TimeFareResult.IsHoliday}}
                <p class="text-orange-600">休日割増: +&yen;{{formatNumber .TimeFareResult.HolidaySurcharge}}（20%増）</p>
                {{end}}
                <p class="font-bold pt-2 border-t mt-2">合計: &yen;{{formatNumber .TimeFareResult.TotalFare}}</p>
            </div>
        </details>

        {{end}}
    </div>

    {{if .UseHighway}}
    <!-- 高速料金 -->
    <div class="bg-white rounded-lg border border-gray-200 p-6">
        <h2 class="text-base font-semibold text-gray-800 mb-4">高速料金</h2>
        {{if .HighwayError}}
        <div class="bg-red-50 border border-red-200 rounded-md p-4 text-sm text-red-700">
            <p>{{.HighwayError}}</p>
        </div>
        {{else if .HighwayToll}}
        <div class="space-y-3">
            <div class="flex justify-between border-b pb-2">
                <span class="text-gray-600">区間</span>
                <span class="font-medium">{{.HighwayToll.OriginIC}} → {{.HighwayToll.DestIC}}</span>
            </div>
            <div class="flex justify-between border-b pb-2">
                <span class="text-gray-600">車種</span>
                <span class="font-medium">{{.HighwayToll.CarTypeName}}</span>
            </div>
            <div class="flex justify-between border-b pb-2">
                <span class="text-gray-600">高速距離</span>
                <span class="font-medium">{{printf "%.1f" .HighwayToll.DistanceKm}} km</span>
            </div>
            <div class="mt-4 pt-2">
                <div class="grid grid-cols-3 gap-3 text-center">
                    <div class="bg-gray-50 p-3 rounded-lg">
                        <div class="text-xs text-gray-500 mb-1">通常料金</div>
                        <div class="text-lg font-bold text-gray-800">&yen;{{formatNumber .HighwayToll.NormalToll}}</div>
                    </div>
                    <div class="bg-blue-50 p-3 rounded-lg">
                        <div class="text-xs text-blue-600 mb-1">ETC料金</div>
                        <div class="text-lg font-bold text-blue-700">&yen;{{formatNumber .HighwayToll.EtcToll}}</div>
                    </div>
                    <div class="bg-green-50 p-3 rounded-lg">
                        <div class="text-xs text-green-600 mb-1">ETC2.0</div>
                        <div class="text-lg font-bold text-green-700">&yen;{{formatNumber .HighwayToll.Etc2Toll}}</div>
                    </div>
                </div>
            </div>
            {{if .HighwayToll.FromCache}}
            <div class="text-xs text-gray-400 text-right">キャッシュから取得</div>
            {{end}}
        </div>
        {{end}}
    </div>

    {{if .TotalWithHighway}}
    <!-- 合計金額 -->
    <div class="bg-blue-600 rounded-lg p-6 text-white">
        <h2 class="text-base font-semibold mb-4">合計金額（運賃 + 高速代）</h2>
        <div class="space-y-2 text-sm">
            <div class="flex justify-between items-center">
                <span class="text-blue-200">運賃（最安〜最高）</span>
                <span class="font-medium">&yen;{{formatNumber .TotalWithHighway.MinFare}} 〜 &yen;{{formatNumber .TotalWithHighway.MaxFare}}</span>
            </div>
            <div class="flex justify-between items-center">
                <span class="text-blue-200">高速代（ETC）</span>
                <span class="font-medium">+ &yen;{{formatNumber .TotalWithHighway.HighwayToll}}</span>
            </div>
            <div class="border-t border-blue-400 pt-3 mt-3">
                <div class="flex justify-between items-center text-xl">
                    <span class="font-bold">合計</span>
                    <span class="font-bold">&yen;{{formatNumber .TotalWithHighway.MinTotal}} 〜 &yen;{{formatNumber .TotalWithHighway.MaxTotal}}</span>
                </div>
            </div>
        </div>
    </div>
    {{end}}
    {{end}}

    <!-- 注意事項 -->
    <div class="text-xs text-gray-500 text-center">
        ※ この運賃計算はあくまで目安です。実際の運賃は運送事業者との契約内容によって異なります。
    </div>
</div>
{{end}}

{{define "error"}}
<div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-md">
    <p class="font-medium">エラー</p>
    <p>{{.Error}}</p>
</div>
{{end}}
